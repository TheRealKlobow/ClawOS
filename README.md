# ClawOS

Public, installable Raspberry Pi image for running OpenClaw OS headless on LAN.

## QUICK START

1. Download Raspberry Pi OS Lite image to `out/base/raspios-lite.img`.
2. Copy env template: `cp .env.example .env` (do not put secrets in git).
3. Build (Linux root shell): `set -a; source .env; set +a; bash image/build.sh`.
4. Flash `out/clawos-pi.img.xz` to SD/USB.
5. Boot Pi on Ethernet (DHCP on `eth0`), then SSH in.

## v0.1.10 defaults

- Headless by default
- SSH enabled
- OpenClaw preinstalled at `/opt/openclaw` (no manual post-flash install)
- `openclaw.service` enabled in image and expected to auto-start after first boot
- `clawos-about` provides image/OpenClaw/Node/service version snapshot
- LAN-only design (Ethernet)
- DHCP on `eth0` by default
- Optional static IP via config/env (`NETWORK_STATIC_ENABLED=true`)
- No Wi-Fi auto-join
- No interactive prompts on boot

## First-boot UX

Choose one:

- **Boot partition drop-in (recommended)**: provide a config file artifact during image customization.
- **Post-boot env edit**: edit `/etc/default/openclaw-gateway` over SSH.

Both flows keep secrets out of git and out of shipped defaults.

## SECURITY

Default posture:

- Gateway bind default is loopback.
- No secrets committed.
- No secrets baked into release artifacts.

Open ports (base expectation):

- `22/tcp` (SSH)
- Gateway defaults to localhost-only bind (`127.0.0.1:18789`)
- LAN bind (`0.0.0.0:18789`) only if explicitly enabled by user

Hardening recommendations:

- Keep gateway on loopback unless explicitly needed
- Use token auth with long random token
- Disable SSH password auth (keys only)
- Restrict inbound access at firewall/router

To enable LAN access explicitly:

1. Edit `/etc/openclaw/openclaw.env`
2. Set `OPENCLAW_GATEWAY_BIND=0.0.0.0`
3. `sudo systemctl restart openclaw`

## Release/versioning

- Current release target: `v0.1.10`
- Release artifact: `clawos-pi.img.xz`
- SHA256 checksums generated by `scripts/release-image.sh`
- Release notes template: `docs/release-notes-template.md`

## Release process

- Release workflow runs on **new tag pushes only** (`v*`).
- Tags are immutable. Never move or force-update an existing tag.
- Patch release scheme is **3-part semver tags** (`v0.1.9`, `v0.1.10`, `v0.1.11`, ...).
- If a release is broken, bump to the next patch version and tag again.
- CI must publish assets for that new tag; do not reuse old tags.

## Release validity guarantees

Every release tag must pass rootfs validation in CI before any GitHub Release is created/uploaded.

Exact CI checks (inside mounted/chrooted image rootfs):

- `dpkg -s openssh-server` succeeds
- `systemctl is-enabled ssh` returns `enabled`
- SSH runtime dir is systemd-managed (`RuntimeDirectory=sshd`) or `/etc/tmpfiles.d/sshd.conf` exists
- if `ssh.socket` exists, it is not enabled (`masked`/`disabled`/`static` only)
- `dpkg -s sudo` succeeds
- `claw` user exists and belongs to `sudo` (group + `su - claw -c 'id -nG'`)
- `node -v` major version is `>= 22`
- `command -v openclaw` resolves to `/usr/local/bin/openclaw`
- `/usr/local/bin/openclaw --help` exits 0
- `/etc/openclaw/openclaw.env` exists and contains exact lines:
  - `OPENCLAW_GATEWAY_BIND=127.0.0.1`
  - `OPENCLAW_GATEWAY_PORT=18789`
- `systemctl cat openclaw.service` succeeds
- if `openclaw.service` is present in unit files, `systemctl is-enabled openclaw.service` returns `enabled`

Release assets are mandatory and checksum-verified in CI:

- `clawos-pi.img.xz`
- `clawos-runtime-<version>.tar.gz`
- `SHA256SUMS.txt`
- `RELEASE_NOTES.md`

If any validation or checksum check fails, CI fails and no release is published.

## Updates

- Manual updater: `sudo clawos-update`
- Version info: `clawos-about`
- OTA runtime artifact: `clawos-runtime-<version>.tar.gz`
- Optional auto-update: `clawos-update.timer` daily at 03:00
- Auto-update runs only when `/etc/clawos/clawos.env` has `AUTO_UPDATE=true`
- Checksum verification is mandatory before apply; failures abort safely
- Runtime update scope is limited to ClawOS-managed files only (no full OS reflashing)

## Support matrix

| Raspberry Pi model | Status | Notes |
|---|---|---|
| Pi 4B (2GB/4GB/8GB) | Pending validation | Target for v0.1.0 proof run |
| Pi 5 | Pending validation | Expected to work; not yet proven |
| Pi 3B/3B+ | Pending validation | Not yet tested |
| Pi Zero 2 W | Pending validation | Ethernet adapter required for LAN-only v1 |

## Branch protection (recommended before public release)

- Protect `main`
- Require PR + review
- Require CI checks
- Disable force-push to `main`

## Disclaimer

This project is provided **as is**, without warranty. You are responsible for your deployment, network exposure, credentials, and system safety.
